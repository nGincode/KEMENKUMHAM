<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Surat Izin Kunjungan Kuasa Hukum</title>
  </head>
  <body
    style="width: 700px; margin: auto; font-family: 'Times New Roman', serif"
    id="body"
  >
    <!-- KOP SURAT -->
    <div style="display: flex; align-items: center; margin-bottom: 5px">
      <img src="img/logo3.png" style="height: 80px; margin-right: 15px" />
      <div style="text-align: center; flex: 1">
        <div style="font-weight: bold">
          KEMENTERIAN IMIGRASI DAN PEMASYARAKATAN REPUBLIK INDONESIA<br />
          DIREKTORAT JENDERAL PEMASYARAKATAN<br />
          KANTOR WILAYAH BENGKULU<br />
          RUMAH TAHANAN NEGARA KELAS IIB BENGKULU
        </div>
        <div style="font-size: 12px">
          Jl. Brigjen Berlian No.556 Bengkulu, Kel. Malabero, Kec. Teluk Segara,
          Kota Bengkulu<br />
          Laman : rutanbengkulu.kemenkumham.go.id, email :
          rutanbengkulu@gmail.com
        </div>
      </div>
    </div>
    <hr style="border: 1px solid black; margin: 0 0 10px 0" />

    <!-- JUDUL -->
    <div
      style="
        text-align: center;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
        text-decoration: underline;
      "
    >
      SURAT IZIN KUNJUNGAN KUASA HUKUM
    </div>

    <!-- ISI SURAT -->
    <div style="text-align: left; font-size: 14px; line-height: 1.8">
      <div
        style="
          margin-top: -10px;
          margin-right: 20px;
          float: right;
          text-align: center;
          padding: 10px;
          background: #5b0101;
          color: white;
          border-radius: 10px;
          font-weight: bolder;
          width: 120px;
        "
      >
        No Antrian <br />
        <div style="font-size: xx-large" id="antrian">1</div>
      </div>

      <div style="font-weight: bold; margin-top: 20px">DATA PENGUNJUNG</div>
      <div id="nama" style="margin-left: 10px">Nama : -</div>
      <div id="NIA" style="margin-left: 10px">Nomor Induk Advokat : -</div>
      <div id="lembaga" style="margin-left: 10px">Lembaga : -</div>
      <div id="tujuan" style="margin-left: 10px">Tujuan : -</div>

      <!-- Foto KTA & Selfi -->
      <div
        style="
          display: flex;
          justify-content: space-evenly;
          margin-top: 15px;
          text-align: center;
        "
      >
        <div>
          <div
            style="
              width: 110px;
              height: 150px;
              border: 2px solid #555;
              border-radius: 8px;
              margin: auto;
              display: flex;
              align-items: center;
              justify-content: center;
              background: white;
              font-size: 12px;
              font-weight: bold;
            "
            id="foto_kta"
          >
            FOTO KTA
          </div>
          <div style="margin-top: 8px; font-weight: bold">Foto KTA</div>
        </div>

        <div>
          <div
            style="
              width: 110px;
              height: 150px;
              border: 2px solid #555;
              border-radius: 8px;
              margin: auto;
              display: flex;
              align-items: center;
              justify-content: center;
              background: white;
              font-size: 12px;
              font-weight: bold;
            "
            id="selfi"
          >
            FOTO SELFI
          </div>
          <div style="margin-top: 8px; font-weight: bold">Foto Selfi</div>
        </div>
      </div>

      <div style="font-weight: bold; margin-top: 10px">
        TAHANAN / NARAPIDANA YANG DIKUNJUNGI
      </div>
      <div id="nama_tahanan" style="margin-left: 10px">Nama : -</div>
      <div id="status_tahanan" style="margin-left: 10px">Status : -</div>
      <div id="perkara_tahanan" style="margin-left: 10px">Perkara : -</div>
      <div id="kamar_tahanan" style="margin-left: 10px">Kamar : -</div>

      <div style="font-weight: bold; margin-top: 20px">WAKTU BERKUNJUNG</div>
      <div id="hari" style="margin-left: 10px">Hari/Tanggal : -</div>

      <div
        style="
          float: right;
          text-align: center;
          margin-right: 50px;
          margin-top: 20px;
        "
      >
        Petugas Loket
        <br /><br /><br /><br />
        <div id="petugas">__________________________</div>
        <div id="petugas_nip">NIP:______________________</div>
      </div>
    </div>

    <script>
      // Fungsi ambil data dari URL dan API (seperti sebelumnya)
      const resizeExternalImage = (img) =>
        `https://images.weserv.nl/?url=https://app.easyrubero.com${img}&q=60`;

      function GetURLParameter(sParam) {
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split("&");
        for (var i = 0; i < sURLVariables.length; i++) {
          var sParameterName = sURLVariables[i].split("=");
          if (sParameterName[0] == sParam) {
            return sParameterName[1];
          }
        }
      }

      const apiIzin = async () => {
        const formData = new FormData();
        formData.append("uuid", GetURLParameter("uuid"));

        const dt = await fetch("api/suratKunjunganKuasaHukum", {
          method: "POST",
          body: formData,
        });

        const data = await dt.json();
        if (data.data?.nama) {
          if (GetURLParameter("petugas") !== "null") {
            document.getElementById("petugas").innerHTML = GetURLParameter(
              "petugas"
            ).replace("%20", " ");
          }

          if (GetURLParameter("NIP") !== "null") {
            document.getElementById("petugas_nip").innerHTML =
              "NIP : " + GetURLParameter("NIP");
          }

          document.getElementById("nama").innerHTML =
            "NAMA : " + data.data.nama;
          document.getElementById("NIA").innerHTML =
            "NOMOR INDUK ADVOKAT : " + data.data.NIA;
          document.getElementById("lembaga").innerHTML =
            "LEMBAGA : " + data.data.lembaga;
          document.getElementById("tujuan").innerHTML =
            "TUJUAN : " + data.data.tujuan;
          if (data.data.img) {
            document.getElementById("foto_kta").innerHTML =
              " <img style='height:150px;width:110px' src='" +
              data.data.img +
              "' />";
          } else {
            document.getElementById("foto_kta").innerHTML = "Tidak ditemukan";
          }
          if (data.data.selfi) {
            document.getElementById("selfi").innerHTML =
              "<img style='height:150px;width:110px' src='" +
              data.data.selfi +
              "' />";
          } else {
            document.getElementById("selfi").innerHTML = "Tidak ditemukan";
          }

          document.getElementById("nama_tahanan").innerHTML =
            "NAMA : " + data.data.tahanan.nama;
          document.getElementById("status_tahanan").innerHTML =
            "STATUS : " + data.data.tahanan.statusTahanan;
          document.getElementById("antrian").innerHTML = data.data.antrian;
          document.getElementById("perkara_tahanan").innerHTML =
            "PERKARA : " + data.data.tahanan.perkara;
          document.getElementById("kamar_tahanan").innerHTML =
            "KAMAR : " + data.data.tahanan.kamar;

          const d = new Date(data.data.waktuKunjungan);

          // Ambil nama hari dalam bahasa Indonesia
          const hari = d.toLocaleDateString("id-ID", { weekday: "long" });

          // Format tanggal (YYYY-MM-DD â†’ dd/mm/yyyy biar lebih enak dibaca)
          const tanggal = d.toLocaleDateString("id-ID", {
            day: "2-digit",
            month: "long",
            year: "numeric",
          });

          const ud = new Date(data.data.updatedAt);

          const jam = String(ud.getHours()).padStart(2, "0");
          const menit = String(ud.getMinutes()).padStart(2, "0");

          document.getElementById("hari").innerHTML =
            "HARI/TANGGAL : " +
            hari.toUpperCase() +
            "/" +
            tanggal +
            " " +
            jam +
            ":" +
            menit;

          function printDiv(divId) {
            var printContents = document.getElementById(divId).innerHTML;
            var originalContents = document.body.innerHTML;

            document.body.innerHTML = printContents;

            window.print();

            document.body.innerHTML = originalContents;
          }

          setTimeout(() => {
            printDiv("body");
          }, 500);
        } else {
          document.getElementById("body").innerHTML =
            "<div>Tidak ditemukan data</div>";
        }
      };

      apiIzin();
    </script>
  </body>
</html>
