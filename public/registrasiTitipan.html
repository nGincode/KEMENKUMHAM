<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registrasi Surat Titipan Barang</title>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  </head>
  <body
    style="width: 700px; margin: auto; font-family: 'Times New Roman', serif"
    id="body"
  >
    <!-- KOP SURAT -->
    <div style="display: flex; align-items: center; margin-bottom: 5px">
      <img src="img/logo3.png" style="height: 80px; margin-right: 15px" />
      <div style="text-align: center; flex: 1">
        <div style="font-weight: bold">
          KEMENTERIAN HUKUM DAN HAK ASASI MANUSIA REPUBLIK INDONESIA<br />
          DIREKTORAT JENDERAL PEMASYARAKATAN<br />
          KANTOR WILAYAH BENGKULU<br />
          RUMAH TAHANAN NEGARA KELAS IIB BENGKULU
        </div>
        <div style="font-size: 12px">
          Jl. Brigjen Berlian No.556 Bengkulu, Kel. Malabero, Kec. Teluk Segara,
          Kota Bengkulu<br />
          Laman : rutanbengkulu.kemenkumham.go.id, email :
          rutanbengkulu@gmail.com
        </div>
      </div>
    </div>
    <hr style="border: 1px solid black; margin: 0 0 20px 0" />

    <!-- HEADER SURAT -->
    <table
      style="
        width: 100%;
        font-size: 14px;
        margin-bottom: 10px;
        border-collapse: collapse;
      "
    >
      <tr>
        <!-- KIRI -->
        <td style="width: 60%; vertical-align: top">
          <table style="border-collapse: collapse; font-size: 14px">
            <tr>
              <td style="width: 80px">Nomor</td>
              <td style="width: 10px">:</td>
              <td>WP.8.PAS.PAS8.KU.01.02 - 62</td>
            </tr>
            <tr>
              <td>Sifat</td>
              <td>:</td>
              <td>Segera</td>
            </tr>
            <tr>
              <td>Lampiran</td>
              <td>:</td>
              <td>-</td>
            </tr>
            <tr>
              <td>Perihal</td>
              <td>:</td>
              <td>-</td>
            </tr>
          </table>
        </td>

        <!-- KANAN -->
        <td style="text-align: right; vertical-align: top">
          <span id="tanggal"></span>
        </td>
      </tr>
    </table>

    <!-- ISI SURAT -->
    <div style="text-align: justify; font-size: 14px; margin-top: 30px">
      <p>
        Terima kasih telah melakukan registrasi kunjungan online di Rumah
        Tahanan Negara Kelas IIB Bengkulu. Mohon untuk menunjukkan kode QR
        berikut kepada petugas loket saat kedatangan.
      </p>
    </div>

    <!-- BARCODE -->
    <div
      style="
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 50px;
        text-align: center;
      "
    >
      <div>
        <div id="barcode" style="display: inline-block"></div>
      </div>
    </div>

    <!-- NOTE -->
    <div style="font-size: 12px; margin-top: 40px">
      <b>Catatan:</b><br />
      Simpan barcode ini dengan melakukan tangkapan layar atau
      <a
        href="#"
        onclick="copylink()"
        style="color: blue; text-decoration: underline"
        >salin tautan</a
      >, dan tunjukkan kepada petugas loket Rutan Bengkulu saat kedatangan.
    </div>

    <script>
      const tanggalElem = document.getElementById("tanggal");
      const bulan = [
        "Januari",
        "Februari",
        "Maret",
        "April",
        "Mei",
        "Juni",
        "Juli",
        "Agustus",
        "September",
        "Oktober",
        "November",
        "Desember",
      ];
      const now = new Date();
      const hari = now.getDate();
      const bulanNama = bulan[now.getMonth()];
      const tahun = now.getFullYear();
      tanggalElem.textContent = `Bengkulu, ${hari} ${bulanNama} ${tahun}`;

      function GetURLParameter(sParam) {
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split("&");
        for (var i = 0; i < sURLVariables.length; i++) {
          var sParameterName = sURLVariables[i].split("=");
          if (sParameterName[0] == sParam) {
            return sParameterName[1];
          }
        }
      }

      const copylink = () => {
        navigator.clipboard.writeText(window.location.href);
        alert("Berhasil dicopy");
      };

      const api = async () => {
        const formData = new FormData();
        formData.append("uuid", GetURLParameter("uuid"));
        formData.append("barcode", true);

        const dt = await fetch("api/suratTitipan", {
          method: "POST",
          body: formData,
        });
        const res = await dt.json();

        if (res.data?.uuid) {
          new QRCode(
            document.getElementById("barcode"),
            res.data.uuid + "|titipan"
          );
        } else {
          document.getElementById("body").innerHTML =
            "<div>Tidak ditemukan data</div>";
        }
      };
      api();
    </script>
  </body>
</html>
